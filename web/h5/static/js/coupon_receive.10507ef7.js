(window.webpackJsonp=window.webpackJsonp||[]).push([["coupon_receive"],{1527:function(e,t,n){"use strict";n("e7e5");var i=n("d399"),a=n("7185");t.a={data:function(){return{count:{showCount:!1,num:60,codeBtnDisable:!1}}},methods:{validateMobileOrPsw:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mobile",t=this.userinfo[e],n=a.a[e];0===t.length&&(this.errorMessage[e]=""),this.errorMessage[e]=n.validator(t)?"":n.message},validatedChecker:function(){this.userinfo.mobile.length>11&&(this.userinfo.mobile=this.userinfo.mobile.substring(0,11));var e=this.userinfo.mobile,t=a.a.mobile;this.validated.mobile=t.validator(e)},countDown:function(){var e=this;this.$nextTick((function(){e.$refs.smsCode.$refs.input.focus()})),this.count.showCount=!0,this.count.codeBtnDisable=!0,this.count.num=60;var t=setInterval((function(){if(e.count.num<=0)return e.count.codeBtnDisable=!1,e.count.showCount=!1,void clearInterval(t);e.count.num-=1}),1e3)},handleSubmit:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.btnDisable||this.fastLogin({mobile:this.userinfo.mobile,smsToken:this.userinfo.smsToken,smsCode:this.userinfo.smsCode,loginType:"sms",client:"h5"}).then((function(t){return e(t)})).catch((function(e){t&&t(e.message),i.a.fail(e.message)}))},handleSendSms:function(){var e=this;this.sendSmsSend(this.userinfo).then((function(t){e.userinfo.smsToken=t.smsToken,e.countDown(),e.dragEnable=!1,e.userinfo.dragCaptchaToken=""})).catch((function(t){switch(t.code){case 4030301:case 4030302:e.dragKey+=1,e.userinfo.dragCaptchaToken="",e.userinfo.smsToken="",i.a.fail(t.message);break;case 4030303:e.dragEnable?i.a.fail(t.message):e.dragEnable=!0;break;default:i.a.fail(t.message)}}))},clickSmsBtn:function(){!this.count.codeBtnDisable&&this.validated.mobile&&(this.dragEnable?this.$refs.dragComponent.dragToEnd?this.$refs.dragComponent.initDragCaptcha():Object(i.a)("请先完成拼图验证"):this.handleSendSms())}}}},"504c":function(e,t,n){var i=n("9e1e"),a=n("0d58"),s=n("6821"),o=n("52a7").f;e.exports=function(e){return function(t){for(var n,r=s(t),c=a(r),u=c.length,l=0,d=[];u>l;)n=c[l++],i&&!o.call(r,n)||d.push(e?[n,r[n]]:r[n]);return d}}},5118:function(e,t,n){(function(e){var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,a=Function.prototype.apply;function s(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new s(a.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new s(a.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n("6017"),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n("24aa"))},6017:function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var i,a,s,o,r,c=1,u={},l=!1,d=e.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(e);f=f&&f.setTimeout?f:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick((function(){m(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?(o="setImmediate$"+Math.random()+"$",r=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&m(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",r,!1):e.attachEvent("onmessage",r),i=function(t){e.postMessage(o+t,"*")}):e.MessageChannel?((s=new MessageChannel).port1.onmessage=function(e){m(e.data)},i=function(e){s.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(a=d.documentElement,i=function(e){var t=d.createElement("script");t.onreadystatechange=function(){m(e),t.onreadystatechange=null,a.removeChild(t),t=null},a.appendChild(t)}):i=function(e){setTimeout(m,0,e)},f.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var a={callback:e,args:t};return u[c]=a,i(c),c++},f.clearImmediate=h}function h(e){delete u[e]}function m(e){if(l)setTimeout(m,0,e);else{var t=u[e];if(t){l=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i)}}(t)}finally{h(e),l=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n("24aa"),n("f28c"))},7067:function(e,t,n){"use strict";n("e17f");var i=n("2241"),a=(n("e7e5"),n("d399")),s=n("a026"),o=n("3ce7"),r=/micromessenger/.test(navigator.userAgent.toLowerCase());t.a=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||n&&!t)a.a.fail("缺少分享参数");else{var c={domainUri:location.origin,itemUri:"",source:"h5"};o.a.marketingActivities({query:{activityId:e},data:c}).then((function(e){var o=-1!==e.url.indexOf("?")?"&":"?",c=n?"".concat(t).concat(o,"ticket=").concat(e.ticket):e.url;r?window.location.href=c:i.a.confirm({message:"去微信完成活动",confirmButtonText:"复制链接",title:""}).then((function(){try{s.a.prototype.$copyText(c).then((function(){a.a.success("复制成功")}),(function(){a.a.fail("请更换浏览器复制")}))}catch(e){a.a.fail("请更换浏览器复制")}})).catch((function(){}))})).catch((function(e){a.a.fail(e.message)}))}}},8615:function(e,t,n){var i=n("5ca1"),a=n("504c")(!1);i(i.S,"Object",{values:function(e){return a(e)}})},8813:function(e,t,n){"use strict";n("28a5"),n("6b54"),n("c5f6");var i=n("0d25");t.a={methods:{timeExpire:function(e,t){return e?(e=Object(i.formatFullTime)(new Date(e)),t=Object(i.formatFullTime)(new Date(t)),"".concat(e," 至 ").concat(t)):(t=Object(i.formatFullTime)(new Date(t)),"有效期截止：".concat(t))},timeCalculation:function(e){var t=(new Date).setDate((new Date).getDate()+Number(e));return t=Object(i.formatFullTime)(new Date(t)),"有效期至：".concat(t)},priceHtml:function(e){var t=e.rate,n=e.type,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=parseInt(t,10),s=a.toString().length>3?"text-16 ml-5":"",o=Number(t).toFixed(2).split(".")[1];o=0===Number(o)?"":".".concat(o);var r="discount"===n?"折":"元";return i?'<span class="'.concat(s,'">').concat(a,'</span><span class="text-14">').concat(o+r,"</span>"):a+o+r},scopeFilter:function(e){var t=e.targetDetail,n=t.numType,i=t.product,a="";if("single"===n)switch(i){case"course":case"classroom":a="指定商品";break;case"vip":a="指定会员";break;default:a=""}else if("all"===n)switch(i){case"course":a="全部课程";break;case"classroom":a="全部班级";break;case"all":a="全部商品";break;case"vip":a="全部会员";break;default:a=""}else switch(i){case"course":case"classroom":a="部分商品";break;default:a=""}return a},handleClick:function(e){this.$emit("buttonClick",e)},receiveTimeExpire:function(e){return Object(i.formatchinaTime)(new Date(e))}}}},"8b9d":function(e,t,n){"use strict";n("6762"),n("2fdb"),n("ac6a"),n("8615"),n("e7e5");var i=n("d399"),a=n("3ce7"),s={classroom:"classroom",course:"course",vip:"vip",all:"all"};t.a={methods:{couponHandle:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.$store.state.token)if(e.currentUserCoupon||t)this.hasreceiveCoupon(e);else{var n=e.token;a.a.receiveCoupon({data:{token:n}}).then((function(t){e.currentUserCoupon=t,i.a.success({message:"领取成功",duration:2e3})})).catch((function(t){i.a.fail(t.message),e.unreceivedNum="0"}))}else this.$router.push({name:"login",query:{redirect:this.$route.fullPath}})},hasreceiveCoupon:function(e){var t=this,n=e.targetDetail.product,a=e.targetDetail.numType;if(Object.values(s).includes(n)){if("single"===a){var o=e.target.id;if(n===s.vip)return void this.$router.push({path:"/vip",query:{id:o}});this.getPathParams(n,o).then((function(e){var i=e.id;i&&t.$router.push({path:"/".concat(n,"/").concat(i)})}))}else if(["multi","all"].indexOf(a)>-1){if("vip"===n)return void this.$router.push({path:"/".concat(e.targetDetail.product)});if("all"===n)return void this.$router.push({path:"/"});this.$router.push({path:"/".concat(e.targetDetail.product,"/explore")})}}else i.a.fail("暂不支持查看：".concat(n,"类型商品"))},getPathParams:function(e,t){return e!==s.course?Promise.resolve({id:t}):a.a.getCourseByCourseSet({query:{id:t}}).then((function(e){return e.length&&e[0]?{id:e[0].id}:Promise.reject({message:"当前课程不存在了"})})).catch((function(e){i.a.fail(e.message)}))}}}},"8e6c":function(e,t,n){"use strict";n("6b54"),n("28a5"),function(e){var t,n;void 0===e.btoa&&(e.btoa=(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),function(e){var n,i,a,s,o,r,c;for(i=a=0,s=e.length,r=(s-=o=s%3)/3<<2,o>0&&(r+=4),n=new Array(r);i<s;)c=e.charCodeAt(i++)<<16|e.charCodeAt(i++)<<8|e.charCodeAt(i++),n[a++]=t[c>>18]+t[c>>12&63]+t[c>>6&63]+t[63&c];return 1==o?(c=e.charCodeAt(i++),n[a++]="".concat(t[c>>2]+t[(3&c)<<4],"==")):2==o&&(c=e.charCodeAt(i++)<<8|e.charCodeAt(i++),n[a++]="".concat(t[c>>10]+t[c>>4&63]+t[(15&c)<<2],"=")),n.join("")})),void 0===e.atob&&(e.atob=(n=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],function(e){var t,i,a,s,o,r,c,u,l,d;if((c=e.length)%4!=0)return"";if(/[^ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\+\/\=]/.test(e))return"";for(l=c,(u="="==e.charAt(c-2)?1:"="==e.charAt(c-1)?2:0)>0&&(l-=4),l=3*(l>>2)+u,d=new Array(l),o=r=0;o<c&&-1!=(t=n[e.charCodeAt(o++)])&&-1!=(i=n[e.charCodeAt(o++)])&&(d[r++]=String.fromCharCode(t<<2|(48&i)>>4),-1!=(a=n[e.charCodeAt(o++)]))&&(d[r++]=String.fromCharCode((15&i)<<4|(60&a)>>2),-1!=(s=n[e.charCodeAt(o++)]));)d[r++]=String.fromCharCode((3&a)<<6|s);return d.join("")}));var i=2654435769;function a(e,t){var n=e.length,i=n<<2;if(t){var a=e[n-1];if(a<(i-=4)-3||a>i)return null;i=a}for(var s=0;s<n;s++)e[s]=String.fromCharCode(255&e[s],e[s]>>>8&255,e[s]>>>16&255,e[s]>>>24&255);var o=e.join("");return t?o.substring(0,i):o}function s(e,t){var n,i=e.length,a=i>>2;0!=(3&i)&&++a,t?(n=new Array(a+1))[a]=i:n=new Array(a);for(var s=0;s<i;++s)n[s>>2]|=e.charCodeAt(s)<<((3&s)<<3);return n}function o(e){return 4294967295&e}function r(e,t,n,i,a,s){return(n>>>5^t<<2)+(t>>>3^n<<4)^(e^t)+(s[3&i^a]^n)}function c(e){return e.length<4&&(e.length=4),e}function u(e){if(/^[\x00-\x7f]*$/.test(e))return e;for(var t=[],n=e.length,i=0,a=0;i<n;++i,++a){var s=e.charCodeAt(i);if(s<128)t[a]=e.charAt(i);else if(s<2048)t[a]=String.fromCharCode(192|s>>6,128|63&s);else{if(!(s<55296||s>57343)){if(i+1<n){var o=e.charCodeAt(i+1);if(s<56320&&o>=56320&&o<=57343){var r=65536+((1023&s)<<10|1023&o);t[a]=String.fromCharCode(240|r>>18&63,128|r>>12&63,128|r>>6&63,128|63&r),++i;continue}}throw new Error("Malformed string")}t[a]=String.fromCharCode(224|s>>12,128|s>>6&63,128|63&s)}}return t.join("")}function l(e,t){return(null==t||t<0)&&(t=e.length),0===t?"":/^[\x00-\x7f]*$/.test(e)||!/^[\x00-\xff]*$/.test(e)?t===e.length?e:e.substr(0,t):t<65535?function(e,t){for(var n=new Array(t),i=0,a=0,s=e.length;i<t&&a<s;i++){var o=e.charCodeAt(a++);switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n[i]=o;break;case 12:case 13:if(!(a<s))throw new Error("Unfinished UTF-8 octet sequence");n[i]=(31&o)<<6|63&e.charCodeAt(a++);break;case 14:if(!(a+1<s))throw new Error("Unfinished UTF-8 octet sequence");n[i]=(15&o)<<12|(63&e.charCodeAt(a++))<<6|63&e.charCodeAt(a++);break;case 15:if(!(a+2<s))throw new Error("Unfinished UTF-8 octet sequence");var r=((7&o)<<18|(63&e.charCodeAt(a++))<<12|(63&e.charCodeAt(a++))<<6|63&e.charCodeAt(a++))-65536;if(!(r>=0&&r<=1048575))throw new Error("Character outside valid Unicode range: 0x".concat(r.toString(16)));n[i++]=r>>10&1023|55296,n[i]=1023&r|56320;break;default:throw new Error("Bad UTF-8 encoding 0x".concat(o.toString(16)))}}return i<t&&(n.length=i),String.fromCharCode.apply(String,n)}(e,t):function(e,t){for(var n=[],i=new Array(32768),a=0,s=0,o=e.length;a<t&&s<o;a++){var r=e.charCodeAt(s++);switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i[a]=r;break;case 12:case 13:if(!(s<o))throw new Error("Unfinished UTF-8 octet sequence");i[a]=(31&r)<<6|63&e.charCodeAt(s++);break;case 14:if(!(s+1<o))throw new Error("Unfinished UTF-8 octet sequence");i[a]=(15&r)<<12|(63&e.charCodeAt(s++))<<6|63&e.charCodeAt(s++);break;case 15:if(!(s+2<o))throw new Error("Unfinished UTF-8 octet sequence");var c=((7&r)<<18|(63&e.charCodeAt(s++))<<12|(63&e.charCodeAt(s++))<<6|63&e.charCodeAt(s++))-65536;if(!(c>=0&&c<=1048575))throw new Error("Character outside valid Unicode range: 0x".concat(c.toString(16)));i[a++]=c>>10&1023|55296,i[a]=1023&c|56320;break;default:throw new Error("Bad UTF-8 encoding 0x".concat(r.toString(16)))}if(a>=32766){var u=a+1;i.length=u,n[n.length]=String.fromCharCode.apply(String,i),t-=u,a=-1}}return a>0&&(i.length=a,n[n.length]=String.fromCharCode.apply(String,i)),n.join("")}(e,t)}function d(e,t){return null==e||0===e.length?e:(e=u(e),t=u(t),a(function(e,t){var n,a,s,c,u,l,d=e.length,f=d-1;for(a=e[f],s=0,l=0|Math.floor(6+52/d);l>0;--l){for(c=(s=o(s+i))>>>2&3,u=0;u<f;++u)n=e[u+1],a=e[u]=o(e[u]+r(s,n,a,u,c,t));n=e[0],a=e[f]=o(e[f]+r(s,n,a,f,c,t))}return e}(s(e,!0),c(s(t,!1))),!1))}function f(e,t){return null==e||0===e.length?e:(t=u(t),l(a(function(e,t){var n,a,s,c,u,l=e.length,d=l-1;for(n=e[0],s=o(Math.floor(6+52/l)*i);0!==s;s=o(s-i)){for(c=s>>>2&3,u=d;u>0;--u)a=e[u-1],n=e[u]=o(e[u]-r(s,n,a,u,c,t));a=e[d],n=e[0]=o(e[0]-r(s,n,a,0,c,t))}return e}(s(e,!1),c(s(t,!1))),!0)))}e.XXTEA={utf8Encode:u,utf8Decode:l,encrypt:d,encryptToBase64:function(t,n){return e.btoa(d(t,n))},decrypt:f,decryptFromBase64:function(t,n){return null==t||0===t.length?t:f(e.atob(t),n)}}}(window)},a262:function(e,t,n){"use strict";var i=n("7067");t.a={methods:{activityHandle:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(i.a)(e,t,n)}}}},cda6:function(e,t,n){"use strict";n.r(t),n("e7e5");var i=n("d399"),a=(n("ac6a"),n("456d"),n("db72")),s=n("2f62"),o=n("3ce7");function r(e){for(var t=e.toString().split("."),n=["","0","00","000","0000"].reverse(),i=0;i<t.length;i+=1){var a=t[i].length;t[i]=n[a]+t[i]}return t.join("")}n("c5f6"),n("6b54"),n("28a5");var c=function(e,t){var n=r(e),i=r(t);return Number(n)<=Number(i)},u=(n("96cf"),n("3b8d")),l=n("f13d"),d=(n("7185"),n("8e6c"),n("a262")),f=n("d863"),h=n("1527"),m={name:"CouponFast",components:{EDrag:l.a},mixins:[d.a,f.a,h.a],data:function(){return{isShow:!1,userinfo:{mobile:"",dragCaptchaToken:void 0,smsCode:"",smsToken:"",type:"sms_login"},dragEnable:!1,dragKey:0,errorMessage:{mobile:""},validated:{mobile:!1},count:{showCount:!1,num:60,codeBtnDisable:!1}}},computed:{btnDisable:function(){return!(this.userinfo.mobile&&this.userinfo.smsCode)},cansentCode:function(){return!(this.count.codeBtnDisable||!this.validated.mobile)}},methods:Object(a.a)({},Object(s.b)(["addUser","setMobile","sendSmsSend","fastLogin"]),{handleSubmitSuccess:function(){var e={mobile:this.userinfo.mobile,smsToken:this.userinfo.smsToken,smsCode:this.userinfo.smsCode};this.$emit("lReceiveCoupon",e)},handleSmsSuccess:function(e){this.userinfo.dragCaptchaToken=e,this.handleSendSms()}})},g=n("a6c2"),p=Object(g.a)(m,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"coupon-receive-login"},[n("div",{staticClass:"receive-login-input"},[n("van-field",{attrs:{border:!1,"error-message":e.errorMessage.mobile,type:"number",placeholder:"请输入手机号码",clearable:""},on:{blur:function(t){return e.validateMobileOrPsw("mobile")},keyup:function(t){return e.validatedChecker()}},model:{value:e.userinfo.mobile,callback:function(t){e.$set(e.userinfo,"mobile",t)},expression:"userinfo.mobile"}})],1),e.dragEnable?n("div",{staticClass:"mobile-drag"},[n("div",{staticClass:"mobile-drag-content"},[e.dragEnable?n("e-drag",{key:e.dragKey,ref:"dragComponent",attrs:{"limit-type":"receive_coupon"},on:{success:e.handleSmsSuccess}}):e._e()],1)]):e._e(),n("div",{staticClass:"receive-login-input"},[n("van-field",{ref:"smsCode",attrs:{border:!1,type:"number",placeholder:"请输入验证码",clearable:"",maxlength:"6"},model:{value:e.userinfo.smsCode,callback:function(t){e.$set(e.userinfo,"smsCode",t)},expression:"userinfo.smsCode"}},[n("div",{class:["code-btn",e.cansentCode?"":"code-btn--disabled"],attrs:{slot:"button"},on:{click:e.clickSmsBtn},slot:"button"},[n("span",{directives:[{name:"show",rawName:"v-show",value:!e.count.showCount,expression:"!count.showCount"}]},[e._v("发送验证码")]),n("span",{directives:[{name:"show",rawName:"v-show",value:e.count.showCount,expression:"count.showCount"}]},[e._v(e._s(e.count.num)+" s")])])])],1),n("div",{class:["receive-login__btn",e.btnDisable?"disabled__btn":""],on:{click:function(t){return e.handleSubmit(e.handleSubmitSuccess)}}},[e._v("\n    立即领取\n  ")]),e._m(0)])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"receive-login__text"},[t("span",{staticClass:"receive-login-tools"},[this._v("新用户领取将为您自动注册")])])}],!1,null,null,null).exports,v=n("8813"),C=n("8b9d"),b=n("5118"),w={name:"FastReceive",components:{fastLogin:p},mixins:[v.a,C.a],data:function(){return{coupons:null,currentUserCoupon:null,login:!1,canuse:!1,hasReceive:!1,receiveFail:!1,failmessage:"优惠券已失效",successmessage:"",loginMethods:!1}},created:function(){this.getCouponInfo()},computed:Object(a.a)({},Object(s.d)({user:function(e){return e.user},isLoading:function(e){return e.isLoading},settings:function(e){return e.settings},couponSwitch:function(e){return e.couponSwitch}}),{username:{get:function(){if(this.$store.state.token)return this.user.verifiedMobile?this.user.verifiedMobile:this.user.nickname}}}),filters:{couponType:function(e){return"discount"==e?"折":"元"}},methods:{getCouponInfo:function(){var e=Object(u.a)(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.$route.params.token,e.next=3,o.a.getCouponInfo({query:{token:t}}).then((function(e){n.coupons=e,!n.cantUseCoupon(e)&&n.isLogin()})).catch((function(e){i.a.fail(e.message)}));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),isLogin:function(){if(this.$store.state.token){this.login=!0;var e={token:this.$route.params.token};this.newReceiveCoupon(e)}},couponType:function(e){var t=e.targetDetail.numType,n=e.targetDetail.product;if("single"===t)switch(n){case"course":case"classroom":return"指定商品";case"vip":return"指定会员";default:return""}else if("all"===t)switch(n){case"course":return"全部课程";case"classroom":return"全部班级";case"all":return"全部商品";case"vip":return"全部会员";default:return""}else switch(n){case"course":case"classroom":return"部分商品";default:return""}},newReceiveCoupon:function(e,t){var n=this;o.a.pluginsReceiveCoupon({data:e}).then((function(e){if(t)return i.a.success("领取成功，正在跳转到详情页..."),void Object(b.setTimeout)((function(){n.useCoupon()}),3e3);n.currentUserCoupon=e,n.successmessage="领取成功，优惠券已放入",n.hasReceive=!0})).catch((function(e){t?"5004507"==e.code?(i.a.success("您已领取过该优惠券，正在跳转到详情页..."),Object(b.setTimeout)((function(){n.useCoupon()}),3e3)):i.a.fail("领取失败，"+e.message):"5004507"==e.code?(n.successmessage="您已领取过，优惠券已放入",n.hasReceive=!0):(n.receiveFail=!0,n.failmessage="领取失败，"+e.message)}))},useCoupon:function(){null!=this.currentUserCoupon&&this.currentUserCoupon.deadline&&this.isOld(this.currentUserCoupon.deadline)?i.a.fail("优惠券已过期"):this.hasreceiveCoupon(this.coupons)},lReceiveCoupon:function(e,t){var n={token:this.$route.params.token};this.loginMethods=!0,this.newReceiveCoupon(n,!0)},isOld:function(e){var t=new Date,n=new Date(Date.parse(e));return t.getTime()>n.getTime()+864e5},cantUseCoupon:function(e){return null!=e.currentUserCoupon?(this.currentUserCoupon=e.currentUserCoupon,this.successmessage="您已领取过该批次优惠券，优惠券已放入",this.hasReceive=!0,this.canuse=!1,!0):0==Number(e.unreceivedNum)?(this.failmessage="优惠券已领完",this.receiveFail=!0,this.canuse=!1,!0):e.deadline&&this.isOld(e.deadline)?(this.failmessage="优惠券已过期",this.receiveFail=!0,this.canuse=!1,!0):(this.canuse=!0,!1)}}},_=Object(g.a)(w,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.coupons?n("div",{staticClass:"coupon-receive"},[e.isLoading?n("e-loading"):e._e(),n("div",{staticClass:"coupon-receive-title text-overflow"},[e._v("\n    "+e._s(e.settings.name)+"\n  ")]),n("div",{staticClass:"coupon-receive-ticket"},[n("div",{staticClass:"ticket-discount"},[n("span",{staticClass:"rate"},[e._v(e._s(parseFloat(e.coupons.rate)))]),e._v(e._s(e._f("couponType")(e.coupons.type))+"\n      "),n("span",[e._v("优惠券")])]),n("div",{staticClass:"ticket-expire text-overflow"},["day"===e.coupons.deadlineMode?n("span",[null!=e.currentUserCoupon?n("span",[e._v("\n          优惠券有效至："+e._s(e.receiveTimeExpire(e.currentUserCoupon.deadline))+"\n        ")]):e._e(),null==e.currentUserCoupon?n("span",[e._v("\n          领取后"+e._s(e.coupons.fixedDay)+"天内有效\n        ")]):e._e()]):e._e(),"time"===e.coupons.deadlineMode?n("span",[n("span",{directives:[{name:"show",rawName:"v-show",value:!e.hasReceive,expression:"!hasReceive"}]},[e._v("领券截止日期：")]),n("span",{directives:[{name:"show",rawName:"v-show",value:e.hasReceive,expression:"hasReceive"}]},[e._v("优惠券有效至：")]),e._v("\n        "+e._s(e.receiveTimeExpire(e.coupons.deadline))+"\n      ")]):e._e()]),n("div",{staticClass:"ticket-range text-overflow"},[e._v("适用于："+e._s(e.couponType(e.coupons)))])]),e.hasReceive&&!e.loginMethods&&e.couponSwitch?n("div",{staticClass:"receive-status"},[n("img",{staticClass:"status-icon",attrs:{src:"static/images/coupon-yes.png"}}),n("div",{staticClass:"status-text"},[e._v(e._s(e.successmessage))]),n("div",{staticClass:"status-user"},[e._v(e._s(e.username)+"账户")]),n("div",{staticClass:"status__btn",on:{click:function(t){return e.useCoupon()}}},[e._v("立即使用")])]):e._e(),e.receiveFail&&!e.loginMethods||!e.couponSwitch?n("div",{staticClass:"receive-status"},[n("img",{staticClass:"status-icon",attrs:{src:"static/images/coupon-no.png"}}),n("div",{staticClass:"status-text"},[e._v(e._s(e.failmessage))])]):e._e(),!e.login&&e.canuse&&e.couponSwitch?n("fast-login",{on:{lReceiveCoupon:e.lReceiveCoupon}}):e._e()],1):e._e()}),[],!1,null,null,null).exports,y={name:"PassReceive",mixins:[v.a,C.a],data:function(){return{item:{},message:"",isReceive:!0}},computed:Object(a.a)({couponStatus:function(){return Object.keys(this.item).length?"coupon-receive-success":""}},Object(s.d)(["couponSwitch"])),created:function(){var e=this;if(this.couponSwitch){var t=this.$route.params.token;this.$store.state.token?t&&o.a.receiveCoupon({data:{token:t}}).then((function(t){e.item=t,e.message="恭喜您成功领取了一张优惠券！"})).catch((function(t){e.message="优惠券领取失败！",i.a.fail(t.message)})):this.$router.push({name:"login",query:{redirect:this.$route.fullPath}})}else i.a.fail("优惠券已失效")}},k={components:{fastReceive:_,passReceive:Object(g.a)(y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"coupon-receive-page"},[n("div",{class:["coupon-card-bg","clearfix",e.couponStatus]},[n("div",{staticClass:"coupon-info"},[e._v(e._s(e.message))]),Object.keys(e.item).length?n("div",{staticClass:"e-coupon__body"},[n("div",{staticClass:"e-coupon__header clearfix"},[n("span",{staticClass:"e-coupon__price",domProps:{innerHTML:e._s(e.priceHtml(e.item))}}),n("div",{staticClass:"e-coupon__name"},[n("div",{staticClass:"text-overflow text-14 coupon-name"},[e._v(e._s(e.item.name))]),e.item.deadlineMode&&"time"!==e.item.deadlineMode?e._e():n("span",{staticClass:"text-10"},[e._v(e._s(e.timeExpire(e.item.createdTime,e.item.deadline)))]),"day"!==e.item.deadlineMode||e.item.currentUserCoupon?e._e():n("span",{staticClass:"text-10"},[e._v("领取后"+e._s(e.item.fixedDay)+"天内有效")]),"day"===e.item.deadlineMode&&e.item.currentUserCoupon?n("span",{staticClass:"text-10"},[e._v(e._s(e.timeExpire(e.item.createdTime,e.item.currentUserCoupon.deadline)))]):e._e()]),n("span",{staticClass:"coupon-button",on:{click:function(t){return e.couponHandle(e.item,e.isReceive)}}},[e._v("去使用")])]),n("div",{staticClass:"e-coupon__middle"}),n("div",{staticClass:"e-coupon__bottom text-overflow"},[e._v("\n        可用范围："+e._s(e.scopeFilter(e.item))+"\n      ")])]):e._e()])])}),[],!1,null,null,null).exports},data:function(){return{sitePlugins:0,cloudSetting:0}},created:function(){this.getsitePlugins()},computed:Object(a.a)({},Object(s.d)({isLoading:function(e){return e.isLoading}})),methods:{getsitePlugins:function(){var e=this;o.a.sitePlugins({query:{pluginName:"coupon"}}).then((function(t){Object.keys(t).length>0&&(c("2.2.10",t.version)?e.sitePlugins=1:e.sitePlugins=2,e.getsettingsCloud())})).catch((function(e){i.a.fail(e.message)}))},getsettingsCloud:function(){var e=this;o.a.settingsCloud().then((function(t){t.sms_enabled?e.cloudSetting=1:e.cloudSetting=2})).catch((function(e){i.a.fail(e.message)}))}}},T=Object(g.a)(k,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"receive-all"},[e.isLoading?n("e-loading"):e._e(),1==e.cloudSetting&&1==e.sitePlugins?n("fast-receive"):e._e(),2==e.cloudSetting||2==e.sitePlugins?n("pass-receive"):e._e()],1)}),[],!1,null,null,null);t.default=T.exports},d863:function(e,t,n){"use strict";n("a481");var i=n("7067");t.a={data:function(){return{redirect:""}},created:function(){this.redirect=decodeURIComponent(this.$route.fullPath)},methods:{afterLogin:function(){var e=this,t=this.$route.query.redirect?decodeURIComponent(this.$route.query.redirect):"/",n=this.$route.query.skipUrl?decodeURIComponent(this.$route.query.skipUrl):"",a=this.$route.query.callbackType,s=this.$route.query.activityId,o=decodeURIComponent(this.$route.query.callback);setTimeout((function(){if(a)switch(a){case"marketing":Object(i.a)(s,o)}else n?e.$router.replace({path:t,query:{backUrl:n}}):e.$router.replace({path:t})}),2e3)}}}},f13d:function(e,t,n){"use strict";var i=n("75fc"),a=(n("e7e5"),n("d399")),s=n("db72"),o=(n("c5f6"),n("3ce7")),r={props:{tips:{type:String,default:"拖动左边滑块完成上方拼图"},limitType:{type:String,default:""}},data:function(){return{imgInfo:{url:"",jigsaw:"",token:""},dragState:{left:0,width:0,currentX:0,currentLeft:0,btnWidth:0,maskWidth:0},dragToEnd:!1}},created:function(){this.initDragCaptcha()},mounted:function(){var e=this.$refs.bar,t=this.$refs.dragBtn,n=(this.$refs.drag,e.getBoundingClientRect());Object.assign(this.dragState,{left:Number(n.left.toFixed(2)),width:e.clientWidth,btnWidth:t.offsetWidth/2})},methods:{initDragCaptcha:function(){var e=this,t={};this.limitType&&(t={limitType:this.limitType}),o.a.dragCaptcha({data:t}).then((function(t){e.imgInfo=Object(s.a)({},t),Object.assign(e.dragState,{currentLeft:0,maskWidth:0}),e.dragToEnd=!1})).catch((function(e){a.a.fail(e.message)}))},handletTouchEnd:function(){var e=this;if(!this.dragToEnd&&this.dragState.currentLeft){var t=this.getToken();this.dragToEnd=!0,o.a.dragValidate({query:{token:t}}).then((function(n){a.a.success("验证成功"),e.$emit("success",t)})).catch((function(t){a.a.fail(t.message),e.initDragCaptcha()}))}},handleTouchMove:function(e){if(!this.dragToEnd){e.preventDefault();var t=this.$refs.dragBtn,n=(this.$refs.dragImgBg,this.dragState),i=e.clientX?e.clientX.toFixed(2):e.targetTouches[0].pageX.toFixed(2)-this.$refs.drag.offsetLeft,a=(i-n.left-n.btnWidth).toFixed(2);a<0&&(a=0),i>n.width+this.$refs.drag.offsetLeft&&(a=n.width-this.$refs.dragImg.width),Object.assign(this.dragState,{currentLeft:a,maskWidth:(Number(a)+t.offsetWidth/2).toFixed(2)})}},calPositionX:function(){var e=this.$refs.dragImgBg,t=(e.naturalWidth/e.width).toFixed(2);return(Number(this.dragState.currentLeft).toFixed(2)*t).toFixed(2)},getToken:function(){var e={token:this.imgInfo.token,captcha:this.calPositionX()};return Object(i.a)(btoa(JSON.stringify(e))).reverse().join("")}}},c=n("a6c2"),u=Object(c.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"drag",staticClass:"e-drag"},[n("div",{staticClass:"e-drag-section"},[n("div",{staticClass:"e-drag-img"},[n("img",{ref:"dragImgBg",attrs:{src:e.imgInfo.url,alt:""}}),n("img",{ref:"dragImg",staticClass:"e-drag-img__dragable",style:{left:e.dragState.currentLeft+"px"},attrs:{src:e.imgInfo.jigsaw,alt:""}})]),n("div",{ref:"bar",staticClass:"e-drag-bar"},[n("span",[e._v(e._s(e.tips))]),n("div",{staticClass:"e-drag-bar__mask",style:{width:e.dragState.maskWidth+"px"}}),n("div",{ref:"dragBtn",staticClass:"e-drag-btn",style:{left:e.dragState.currentLeft+"px"},on:{touchend:e.handletTouchEnd,touchmove:e.handleTouchMove}},[n("img",{attrs:{src:"static/images/drag.png",alt:""}})])])])])}),[],!1,null,null,null);t.a=u.exports}}]);