(window.webpackJsonp=window.webpackJsonp||[]).push([["pay"],{"38a4":function(t,a,e){"use strict";e.r(a),e("a481"),e("e7e5");var i=e("d399"),s=(e("96cf"),e("3b8d")),c=e("db72"),n=e("3ce7"),r=(e("bc3a"),e("2f62")),o={data:function(){return{detail:{},payWay:"",selected:!0,paySettings:{},inWechat:this.isWeixinBrowser(),targetType:this.$route.query.targetType,timeoutId:-1}},computed:Object(c.a)({},Object(r.d)(["wechatSwitch","isLoading"]),{validPayWay:function(){return this.paySettings.wxpayEnabled||this.paySettings.alipayEnabled&&!this.inWechat}}),created:function(){var t=Object(s.a)(regeneratorRuntime.mark((function t(){var a,e,s,c=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.a.getSettings({query:{type:"payment"}}).catch((function(t){i.a.fail(t.message)}));case 2:this.paySettings=t.sent,this.paySettings.alipayEnabled&&!this.inWechat?this.payWay="Alipay_LegacyH5":this.paySettings.wxpayEnabled&&(this.payWay="WechatPay_H5"),a=this.$route.query,a.source,a.id,e=a.sn,s=a.targetId,n.a.getOrderDetail({query:{sn:e}}).then((function(t){if("success"===t.status&&s){if(c.wechatSwitch)return void c.$router.replace({path:"/pay_success",query:{targetType:c.targetType,targetId:s}});c.$router.push({path:"/".concat(c.targetType,"/").concat(s)})}c.detail=Object.assign({},t)})).catch((function(t){i.a.fail(t.message)}));case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),beforeRouteLeave:function(t,a,e){clearTimeout(this.timeoutId),e()},methods:{handlePay:function(){var t=this;this.validPayWay&&("WechatPay_H5"===this.payWay&&this.inWechat?window.location.href="".concat(window.location.origin,"/pay/center/wxpay_h5?pay_amount=")+"".concat(this.detail.pay_amount,"&title=").concat(this.detail.title,"&sn=").concat(this.detail.sn):n.a.createTrade({data:{gateway:this.payWay,type:"purchase",orderSn:this.detail.sn,app_pay:"Y"}}).then((function(a){"WechatPay_H5"!==t.payWay?window.location.href=a.payUrl:t.getTradeInfo(a.tradeSn).then((function(){window.location.href=a.mwebUrl}))})).catch((function(t){i.a.fail(t.message)})))},isWeixinBrowser:function(){return/micromessenger/.test(navigator.userAgent.toLowerCase())},getTradeInfo:function(t){var a=this;return n.a.getTrade({query:{tradesSn:t}}).then((function(e){if(e.isPaid)return a.wechatSwitch?void a.$router.replace({path:"/pay_success",query:{paidUrl:window.location.origin+e.paidSuccessUrlH5}}):void(window.location.href=window.location.origin+e.paidSuccessUrlH5);a.timeoutId=setTimeout((function(){a.getTradeInfo(t)}),2e3)})).catch((function(t){i.a.fail(t.message)}))}}},l=e("a6c2"),d=Object(l.a)(o,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"payPage"},[t.isLoading?e("e-loading"):t._e(),e("div",{staticClass:"payPage__order"},[e("div",{staticClass:"order__head order--line"},[t._v("\n      支付方式\n    ")]),e("div",{staticClass:"order__infomation"},[e("div",{staticClass:"title"},[t._v(t._s(t.detail.title))]),e("div",{staticClass:"sum"},[e("span",[t._v("待支付")]),e("span",{staticClass:"sum__price"},[t._v("¥ "),e("span",{staticClass:"num"},[t._v(t._s(t._f("toMoney")(t.detail.pay_amount)))])])]),e("div",{staticClass:"payWay"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.paySettings.alipayEnabled&&!t.inWechat,expression:"paySettings.alipayEnabled && !inWechat"}],class:["payWay__item",{"payWay__item--selected":"Alipay_LegacyH5"===t.payWay}],on:{click:function(a){t.payWay="Alipay_LegacyH5",t.selected=!0}}},[e("img",{staticClass:"correct",attrs:{src:"static/images/correct.png"}}),e("div",{staticClass:"right"}),e("img",{attrs:{src:"static/images/zfb.png"}})]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.paySettings.wxpayEnabled,expression:"paySettings.wxpayEnabled"}],class:["payWay__item",{"payWay__item--selected":"WechatPay_H5"===t.payWay}],on:{click:function(a){t.payWay="WechatPay_H5",t.selected=!1}}},[e("img",{staticClass:"correct",attrs:{src:"static/images/correct.png"}}),e("div",{staticClass:"right"}),e("img",{attrs:{src:"static/images/wx.png"}})])])])]),e("div",{class:["payPage__payBtn",{disabled:!t.validPayWay}],on:{click:t.handlePay}},[t._v("\n    "+t._s(t.validPayWay?"立即支付":"无可用支付方式")+"\n  ")])],1)}),[],!1,null,null,null);a.default=d.exports},dec6:function(t,a,e){"use strict";e.r(a),e("a481");var i=e("db72"),s=e("2f62"),c={data:function(){return{targetId:this.$route.query.targetId||"",targetType:this.$route.query.targetType||"",paidUrl:this.$route.query.paidUrl}},computed:Object(i.a)({},Object(s.d)(["wechatSwitch","wechatSettings"])),created:function(){this.wechatSwitch||this.$router.replace({path:"/"})},methods:{backToCourse:function(){this.paidUrl?window.location.href=this.paidUrl:this.$router.replace({path:"/".concat(this.targetType,"/").concat(this.targetId)})}}},n=e("a6c2"),r=Object(n.a)(c,(function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"pay-success-container"},[this._m(0),this.wechatSettings?a("div",{staticClass:"qrcode-img-container"},[a("img",{attrs:{src:this.wechatSettings.official_qrcode,alt:""}})]):this._e(),this._m(1),a("van-button",{staticClass:"btn-back-course",attrs:{type:"primary"},on:{click:this.backToCourse}},[this._v("返回课程")])],1)}),[function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"pay-success-text"},[a("i",{staticClass:"h5-icon h5-icon-check"}),a("span",{staticClass:"text-18 success-text"},[this._v("支付成功！")]),a("div",{staticClass:"mt5 text-14 color-red"},[this._v("为享受更好的教学服务，建议您开启课程通知。")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"press-img-container"},[a("img",{attrs:{src:"static/images/wechat_press.png",alt:""}}),a("div",{staticClass:"press-text text-14"},[this._v("请长按二维码开启课程通知")])])}],!1,null,null,null);a.default=r.exports}}]);